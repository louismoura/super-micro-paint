<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Super Micro Paint</title>
        <link href='//fonts.googleapis.com/css?family=Fugaz+One' rel='stylesheet' type='text/css'>
        <link href="style.css" rel="stylesheet">
        <link href="icomoon/style.css" rel="stylesheet">
        <script src="array2d.js"></script>
        <script src="super-pixel-grid.js"></script>
        <script src="lib/lodash.min.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/angular.min.js"></script>
        <script src="app.js"></script>
        <meta name="viewport" content="width=900">
    </head>
    <body ng-app="super-micro-paint" ng-controller="MainCtrl" ng-touchcancel="penUp($event)">
      <div class="case">
        <h1>Super Micro Paint</h1>
        <div class="container">
            <div class="tools drawing-tools">
              <label class="btn" ng-class="{'active': activeTool == 'pencil'}">
                <input type="radio" name="tool" ng-model="activeTool" value="pencil" checked ng-disabled="mode != 'normal'">
                <span class="icon-pencil" />
              </label>
              <label class="btn" ng-class="{'active': activeTool == 'fill'}">
                <input type="radio" name="tool" ng-model="activeTool" value="fill" ng-disabled="mode != 'normal'">
                <span class="icon-fill" />
              </label>
              <label class="btn" ng-class="{'active': activeTool == 'line'}">
                <input type="radio" ng-model="activeTool" value="line" ng-disabled="mode != 'normal'">
                <span class="icon-line" />
              </label>
              <label class="btn" ng-class="{'active': activeTool == 'rectangle'}">
                <input type="radio" ng-model="activeTool" value="rectangle" ng-disabled="mode != 'normal'">
                <span class="icon-square" />
              </label>
              <label class="btn" ng-class="{'active': activeTool == 'ellipse'}">
                <input type="radio" ng-model="activeTool" value="ellipse" ng-disabled="mode != 'normal'">
                <span class="icon-circle" />
              </label>
            </div>
            <div class="tools picture-tools">
              <label class="btn">
                <button type="button" ng-click="nudge(-1, 0)" ng-disabled="mode != 'normal'">
                <span class="icon-left" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="nudge(1, 0)" ng-disabled="mode != 'normal'">
                <span class="icon-right" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="nudge(0, -1)" ng-disabled="mode != 'normal'">
                <span class="icon-up" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="nudge(0, 1)" ng-disabled="mode != 'normal'">
                <span class="icon-down" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="clear()" ng-disabled="mode != 'normal'">
                <span class="icon-clear" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="invert()" ng-disabled="mode != 'normal'">
                <span class="icon-invert" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="doLifeStep()" ng-disabled="mode != 'normal'">
                <span class="icon-life" />
                </button>
              </label>
              <label class="btn" ng-class="{'blink': mode == 'copy'}">
                <button type="button" ng-click="copyStart()">
                <span class="icon-copy" />
                </button>
              </label>
              <label class="btn" ng-class="{'active': canUndo()}">
                <button type="button" ng-click="undo()" ng-disabled="!canUndo() || mode != 'normal'">
                <span class="icon-undo" />
                </button>
              </label>
              <label class="btn" ng-class="{'active': canRedo()}">
                <button type="button" ng-click="redo()" ng-disabled="!canRedo() || mode != 'normal'">
                <span class="icon-redo" />
                </button>
              </label>
              <label class="btn">
                <button type="button" ng-click="save()" ng-disabled="mode != 'normal'">
                <span class="icon-save" />
                </button>
              </label>
            </div>
            <div class="frame"
             ng-mousedown="penDown($event)" ng-touchstart="penDown($event)"
             ng-mouseover="penOver($event)" ng-touchmove="penOver($event)"
             ng-mouseup="penUp($event)" ng-touchend="penUp($event)"
             >
                <div ng-repeat="y in range(height) track by $index" class="row">
                    <span ng-repeat="x in range(width) track by $index" class="pixel" ng-class="overlay.get($index, $parent.$index) ? 'blink' : frames[currentFrame].get($index, $parent.$index) ? 'pixel-on' : 'pixel-off'" data-index="{{$index}},{{$parent.$index}},{{currentFrame}}"></span>
                </div>
            </div>
        </div>
        <div class="previews">
           <div class="previewwrap" ng-repeat="frame in frames" ng-class="{'active': $index==$parent.currentFrame, 'blink': $index==$parent.currentFrame && mode == 'copy'}" ng-click="previewClick($index);" on-finish-render="ngRepeatFinished">
            <canvas width="64" height="32" id="preview{{$index}}"> </canvas> 
           </div>
           <div class="previewwrapani">
            <canvas width="64" height="32" id="previewani"></canvas>
           </div>
        </div>
      </div>
      <script>
      var blinkTimer = function() {
        var blinkState = true;
        var blinkStyle = document.createElement('style');
        document.head.appendChild(blinkStyle);
        var blink = function() {
          if (blinkState === true) {
            blinkStyle.innerHTML = ".pixel.blink::after {background-color: rgba(40, 40, 40, .05);}";
          } else {
            blinkStyle.innerHTML = ".pixel.blink::after {background-color: rgba(40, 40, 40, .85); box-shadow: 1px 1px 2px #888;}";
          }
          blinkState = !blinkState;
        };
        window.setInterval(blink, 400);
      }();
      </script>
    </body>
</html>